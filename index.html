<!doctype html>
<html lang="sq">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MarketPlace Affiliate - Demo</title>
<style>
  body{font-family:Arial, sans-serif;background:#f5f7fb;color:#111;margin:0;padding:20px}
  header{display:flex;justify-content:space-between;align-items:center}
  h1{font-size:18px;margin:0}
  .searchBox{margin:18px 0;display:flex;gap:8px}
  input[type="search"]{flex:1;padding:10px;border-radius:8px;border:1px solid #cfd8e3}
  button{padding:10px 12px;border-radius:8px;border:none;background:#0066ff;color:white;cursor:pointer}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;margin-top:12px}
  .card{background:white;border-radius:10px;padding:12px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
  .card img{width:100%;height:140px;object-fit:cover;border-radius:6px}
  .card h3{font-size:15px;margin:8px 0}
  .card .price{font-weight:bold;color:#0b6}
  .card .cta{margin-top:8px;display:flex;gap:6px}
  .muted{font-size:13px;color:#666}
  footer{margin-top:18px;font-size:13px;color:#666}
  .note{background:#fffbe6;padding:10px;border-radius:8px;border:1px solid #ffecb5;margin-top:12px}
</style>
</head>
<body>
<header>
  <h1>Butiku indivudal — Kërko & porosit (Affiliate Demo)</h1>
  <div>Komision: <strong>10%</strong></div>
</header>

<div class="searchBox">
  <input id="q" type="search" placeholder="Kerko për: rroba, këpucë, varse, ora, kapelë..." />
  <button id="searchBtn">Kërko</button>
</div>

<!-- Rezultatet -->
<div id="results" class="grid"></div>

<!-- Modal porosie -->
<div id="modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;">
  <div style="background:white;padding:16px;border-radius:8px;max-width:420px;width:94%;">
    <h3 id="mTitle">Konfirmo porosinë</h3>
    <p id="mDesc" class="muted">Një rishikim i shpejtë përpara se të ridrejtoheni tek furnizuesi.</p>
    <div style="display:flex;gap:8px;margin-top:10px">
      <button id="confirmBtn" style="flex:1;background:#06a84b;color:white;padding:10px;border-radius:8px;border:none">Porosis</button>
      <button id="cancelBtn" style="flex:1;background:#eee;padding:10px;border-radius:8px;border:none">Anulo</button>
    </div>
    <div style="margin-top:8px;font-size:13px;color:#444">
      Shënim: Ky demo *ridrejton* tek furnizuesi; pagesa bëhet tek ai. Ti fiton komision sapo furnizuesi konfirmon shitjen.
    </div>
  </div>
</div>

<div class="note">
  <strong>Shënim ligjor:</strong> Nëse përdor model affiliate, vendos qartë politikat e kthimit dhe transparencën për përdoruesit. Nëse zgjedh dropshipping, hyn në marrëveshje me furnizuesin.
</div>

<footer>
  <div>Demo: Ky faqe është një shembull. Për të lidhur me affiliate real, zëvendëso `supplierUrl` në kod me linkun tënd me tracking.</div>
</footer>

<script>
/* === SAMPLE CATALOG (në prod: përdor API që sjell produkte real nga furnizuesit) === */
const sampleProducts = [
  { id: 'p1', title:'Kapele sportive - Black', price: 12.99, img:'https://picsum.photos/seed/hat/400/300', supplierUrl:'https://example-supplier.com/product/hat-123?aff=AFFID' },
  { id: 'p2', title:'Zinxhir dore - Stainless', price: 24.90, img:'https://picsum.photos/seed/chain/400/300', supplierUrl:'https://example-supplier.com/product/chain-77?aff=AFFID' },
  { id: 'p3', title:'Syze verore - Trend', price: 39.00, img:'https://picsum.photos/seed/glasses/400/300', supplierUrl:'https://example-supplier.com/product/glass-55?aff=AFFID' },
  { id: 'p4', title:'Shall qafë - Premium', price: 18.00, img:'https://picsum.photos/seed/scarf/400/300', supplierUrl:'https://example-supplier.com/product/scarf-21?aff=AFFID' },
  { id: 'p5', title:'Këpucë sportive', price: 68.50, img:'https://picsum.photos/seed/shoe/400/300', supplierUrl:'https://example-supplier.com/product/shoe-22?aff=AFFID' }
];

/* === SETTINGS - Zëvendëso AFF link me atë tënd nga programi affiliate === */
const AFFILIATE_TAG = 'tuaja_aff=MYAFF123'; // shembull, duhet ta marrësh nga programi i partnerit

/* === RENDER & SEARCH === */
const resultsEl = document.getElementById('results');
function renderList(list){
  resultsEl.innerHTML = '';
  list.forEach(p=>{
    const div = document.createElement('div'); div.className='card';
    div.innerHTML = `
      <img src="${p.img}" alt="${p.title}" />
      <h3>${p.title}</h3>
      <div class="price">${p.price.toFixed(2)} €</div>
      <div class="muted">Disponueshme: <strong>Po</strong></div>
      <div class="cta">
        <button data-id="${p.id}" class="buyBtn" style="flex:1;background:#0066ff;color:#fff;padding:8px;border-radius:8px;border:none;cursor:pointer">Porosit</button>
        <button data-id="${p.id}" class="wishBtn" style="background:#eee;padding:8px;border-radius:8px;border:none;cursor:pointer">Shiko</button>
      </div>`;
    resultsEl.appendChild(div);
  });
}
renderList(sampleProducts);

document.getElementById('searchBtn').addEventListener('click', ()=>{
  const q = document.getElementById('q').value.trim().toLowerCase();
  if(!q){ renderList(sampleProducts); return; }
  const filtered = sampleProducts.filter(p=> p.title.toLowerCase().includes(q) );
  renderList(filtered.length?filtered:sampleProducts);
});

/* === ORDER FLOW: open modal then redirect with affiliate param === */
const modal = document.getElementById('modal');
let currentProduct = null;
resultsEl.addEventListener('click', (ev)=>{
  const btn = ev.target.closest('button');
  if(!btn) return;
  const id = btn.dataset.id;
  const p = sampleProducts.find(x=>x.id===id);
  if(btn.classList.contains('buyBtn')){
    currentProduct = p;
    document.getElementById('mTitle').textContent = 'Porosis: ' + p.title;
    document.getElementById('mDesc').textContent = 'Çmim: ' + p.price.toFixed(2) + ' €. Do ridrejtoheni tek furnizuesi për të përfunduar pagesën.';
    modal.style.display = 'flex';
  } else if(btn.classList.contains('wishBtn')){
    alert('Shiko më shumë: ' + p.title + '\\nÇmim: ' + p.price.toFixed(2) + ' €');
  }
});

document.getElementById('cancelBtn').addEventListener('click', ()=>{ modal.style.display='none'; currentProduct=null; });

document.getElementById('confirmBtn').addEventListener('click', ()=>{
  if(!currentProduct) return;
  // 1) Regjistro në sistemin tënd (lokal) për të ndjekur porosinë - MUND ta dërgosh në server me fetch
  const sale = {
    id: 'local-'+Date.now(),
    productId: currentProduct.id,
    title: currentProduct.title,
    price: currentProduct.price,
    timestamp: Date.now()
  };
  // Ruaje lokalisht (nëse do shofësh shitjet)
  const sales = JSON.parse(localStorage.getItem('affiliate_sales')||'[]');
  sales.unshift(sale);
  localStorage.setItem('affiliate_sales', JSON.stringify(sales.slice(0,200)));
  // 2) Ndërto link affiliate: script assumes supplierUrl + '&' + AFFILIATE_TAG or replace placeholder AFFID
  // Example: replace placeholder "AFFID" me tracking code (if sampleUrls use '?aff=AFFID')
  let target = currentProduct.supplierUrl.replace('AFFID', 'YOUR_AFF_ID');
  // In some cases affiliate param must be appended:
  if(target.indexOf('?') === -1) target += '?' + AFFILIATE_TAG; else if(target.indexOf('tuaja_aff')===-1) target += '&' + AFFILIATE_TAG;
  // 3) Redirect user to supplier (actual checkout happens at supplier)
  modal.style.display = 'none';
  currentProduct = null;
  // Log and then redirect
  console.log('Redirecting to supplier:', target);
  // If do të ndjekësh konfirmime shitjesh nga furnizuesi, duhet server-side callback (webhooks) nga affiliate programi.
  window.location.href = target;
});

/* === ADMIN: shiko shitjet lokale (thjeshtë demo) === */
function showLocalSales(){
  const s = JSON.parse(localStorage.getItem('affiliate_sales')||'[]');
  if(!s.length) return alert('S’ka shitje të regjistruara (lokale).');
  let txt = 'Shitjet lokale:\\n';
  s.slice(0,50).forEach(x=> txt += `${new Date(x.timestamp).toLocaleString()} — ${x.title} — ${x.price} €\\n`);
  alert(txt);
}
// shortcut: ctrl+s për të parë shitjet lokale
window.addEventListener('keydown', (e)=>{ if(e.ctrlKey && e.key === 's'){ e.preventDefault(); showLocalSales(); } });

</script>
</body>
</html>
